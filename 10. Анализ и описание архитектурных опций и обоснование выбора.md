# Анализ и описание архитектурных опций и обоснование выбора
## Выбор архитектурного подхода
При разработке программного обеспечения важно получить выгоду и увидеть результат как можно раньше. Скорость разработки, добавление новых функциональностей, тестирование продукта позволяет на первых этапах разработки программного обеспечения склониться в сторону монолитного как мобильного, так и серверного приложения.

При разработке важно не забывать разбиение на модули. При развитии функционала эти модули постепенно начнут отпочковываться от основного приложения, выходя на микросервисную архитектуру.

Итак, что даст монолитное приложение на первых шагах разработки:
- низкую стоимость работ;
- быстроту и простоту развертываемости приложения;
- быстрое внедрение функциональности;
- простоту тестирования до тех пор, пока само приложение не перерастет монолит по функциональности;
- повышенную защиту информации благодаря централизованной контрольной точке в монолитной архитектуре;
- улучшение производительности за счет общего кода и памяти.

## Выбор СХД
"Кто владеет информацией, тот владеет миром" (с) Ротшильд.

Выбор системы хранения данных - всегда сложная задача. Все системы хранения можно разделить на реляционные и не реляционные. Рассмотрим достоинства каждого типа.

Реляционная модель данных – логическая модель данных. В реляционной  модели достигается гораздо более  высокий уровень абстракции данных, чем в иерархической или сетевой.
Преимущества реляционных баз данных:
- простота и доступность для понимания. Единственной используемой информационной конструкцией является "таблица";
- строгие правила проектирования, базирующиеся на математическом аппарате;
- полная независимость данных. Изменения в прикладной программе при изменении реляционной БД минимальны;
- для организации запросов и написания программного продукта нет необходимости знать конкретную организацию БД во внешней памяти;
- удобно храненить структурированные данные;
- возможность интерактивного выполнения запросов.

Недостатки реляционной модели:
- предметная область не всегда может быть представлена табличном виде;
- множество таблиц приводит к трудностям в понимании структуры данных;
- занимает достаточно много внешней памяти;
- относительно низкая скорость доступа к данным;
- сложность структуры, вызванная процессом нормализации;
- типы данных ограничены (например, отсутствует тип данных "мультимедия" и т,д.);
- невозможно рассмотреть данных на разных уровнях абстракций;
- при определенных сочетаниях данных приходится принебрегать третьей, а иногда и второй, нормальной формой.

Нереляционная база данных — это база данных, в которой в отличие от большинства традиционных систем баз данных не используется табличная схема строк и столбцов. В этих базах данных применяется модель хранения, оптимизированная под конкретные требования типа хранимых данных.

Преимущества не реляционных баз данных:
- линейная масштабируемость за счет добавления новых узлов в кластер;
- гибкость;
- возможность работать с разными представлениями информации (в том числе и с мультимедией);
- высокая скорость обработки данных;
- высокая производительность за счет оптимизации для конкретных видов моделей данных (документной, графовой, колоночной или «ключ‑значение») и шаблонов доступа.

Недостатки не реляционных баз данных:
- ограниченная емкость встроенного языка запросов;
- сложности в поддержке всех ACID-требований к транзакциям (атомарность, консистентность, изоляция, долговечность) из-за того, что NoSQL-СУБД вместо CAP-модели (согласованность, доступность, устойчивость к разделению) скорее соответствуют модели BASE (базовая доступность, гибкое состояние и итоговая согласованность);
- сильная привязка приложения к конкретной СУБД из-за специфики внутреннего языка запросов и гибкой модели данных, ориентированной на конкретный случай.

В разрабатываемом программном продукте несколько модулей, по-разному обрабатываюших данных, что влияет на выбор типа базы данных. 
Так для модулей:
- пользователи;
- турниры;
- пользователи;
- сообщения

лучше испнользовать реляционную базу данных, так как данные в этих модулях легко представляются в табличном виде, имеют строгие правила. Это позволит легко работать с данными в них.

Аналогично для мобильного приложения.

Для модулей, не имеющих строгой структуры данных, а также работающих с большими объемами данных, актуально использование нереляционных БД. Таковыми являются следующие модули:
- тренировки;
- блоги;
- метрики.

### Реляционные базы данных

Выбор базы данных из реляционных складывается из следующих основных аспектов:
- тип лицензии для использования;
- совместимость с различными операционными системами;
- транзакционность;
- производительность;
- функциональность.

Ниже приведены сравнительные характеристики СУБД.

1. Совместимость с различными операционными системами 

Database Name|Windows|macOS|Linux|UNIX|iOS|Android
---|---|---|---|---|---|---
Microsoft SQL Server|Да|Нет|Да|Нет|Нет|Нет
MySQL|Да|Да|Да|Да| ?|Да
Oracle|Да|Нет|Да|Да|Нет|Нет
PostgreSQL|Да|Да|Да|Да|Нет|Да
SQLite|Да|Да|Да|Да|Да|Да

2. Основные функции

Database Name|ACID|Ссылочная целостность|Транзакции|Гранулярная блокировка|Управление параллельным доступом с помощью многоверсионности|Юникод|Интерфейс|Вывод типа
---|---|---|---|---|---|---|---|---
Microsoft SQL Server|Да|Да|Да|Да (Блокировка уровня строки)|Да|Да|GUI & SQL|Да
MySQL|Да2|Да3|Да2 кроме DDL|Да (Блокировка уровня строки)|Да|Да|GUI & SQL|Да
Oracle|Да|Да|Да кроме DDL|Да (Блокировка уровня строки)|Да|Да|API & GUI & SQL|Да
PostgreSQL|Да|Да|Да|Да (Блокировка уровня строки)|Да|Да|API & GUI & SQL|Нет
SQLite|Да|Да|Да|Нет (Блокировка на уровне базы данных)|Нет|Опционально|API & SQL|Да

3. Основные возможности

Database Name|Union|Intersect|Except|Inner joins|Outer joins|Inner selects|Merge joins|Blobs & Clobs|Общие выражения таблицы|Оконные функции|Параллельный запрос
---|---|---|---|---|---|---|---|---|---|---|---
Microsoft SQL Server|Да|Да|Да|Да|Да|Да|Да|Да|Да|Да|Да
MySQL|Да|Нет|Нет|Да|Да|Да|Нет|Да|Нет|Нет|Нет
Oracle|Да|Да|Да, через MINUS|Да|Да|Да|Да|Да|Да 1|Да|Да
PostgreSQL|Да|Да|Да|Да|Да|Да|Да|Да|Да|Да|Да
SQLite|Да|Да|Да|Да|Только LEFT|Да|Нет|Да|3.8.3+|Нет|Нет

4. Поддержка объектов "из коробки"

Database Name|Домен|Курсор|Триггер|Функция|Процедура|Внешняя процедура
---|---|---|---|---|---|---
Microsoft SQL Server|Да|Да|Да|Да|Да|Да
MySQL|Нет|Да|Да|Да|Да|Да
Oracle|Да|Да|Да|Да|Да|Да
PostgreSQL|Да|Да|Да|Да|Да|Да
SQLite|Нет|Нет|Да|Нет|Нет|Да

5. Ограничения

Database Name| Максимальный размер БД| Максимальный размер таблицы|Максимальный размер строки|Максимальное количество столбцов на строку|Максимальный размер Blob/Clob|Максимальный размер Char|Максимальный размер Number|Минимальное значение DATE|Максимальное значение DATE|Максимальный размер имени столбца
---|---------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|---|---|---|---|---|---|---|---
Microsoft SQL Server| 16 Збайт на документ| 524,272 Тбайт|8,060 байт/2Тбайт5|1,024/30,000(с разреженными столбцами)|2 Гбайт/Не ограничено (используя RBS/FILESTREAM объекты)|2 Гбайт5|126 бит2|0001|9999|128
MySQL| Не ограничено | MyISAM ограничения на хранения: 256 Тбайт; Innodb ограничения на хранения: 64 Тбайт |64 Кбайт3|4,0964|4 Гбайт (longtext, longblob)|64 Кбайт (текст)|64 бита|1000|9999|64
Oracle| 2Пбайт (со стандартным блоком 8k) 8Пбайт (с максимальным блоком 32k) 8Эбайт (с максимальным размером 32 Кбайт и опцией BIGFILE) | 4 Гбайт  размер блока (с табличным пространством BIGFILE)                           |8 Кбайт|1,000|128 Тбайт|32,767 Б10|126 bits|−4712|9999|30
PostgreSQL| Не ограничено| 32 Тбайт|1.6 Тбайт|250–1600 в зависимости от типа|1 Гбайт (текст, байт) - хранится в строке или 4 Тбайт (хранится в pg_largeobject)|1 Гбайт|Не ограничено|−4,713|5,874,897|63
SQLite| 128 Тбайт (231 страниц * (максимальный размер страницы 64 КБ) | Ограничено размером файла |Ограничено размером файла|32,767|2 GB|2 GB|64 bits|Нет типа DATE8|Нет типа DATE8|Не ограничено

Вывод:
Самым мощным инструментом работы с реляционными базами данных является Oracle, однако имеет проприетарную лицензию, в отличие от PostgreSQL. PostgreSQL немногим уступает Oracle, что делает выбор данного СУБД приоритетным. Если же говорить о Microsoft SQL Server, то оно имеет большое ограничение по совместимости с операционными системами и также является проприетарным.
Для мобильного приложения отлично подходит SQLite не смотря на все ограничения, которые она имеет. Основная причина - доступность для мобильных операционных систем. 

### Не реляционные базы данных
Для выбора нереляционной СУБД выбраны самые популярные экземпляры:
- MongoDB;
- Redis;
- Cassandra;
- Elasticsearch;
- Firebase.

Тип лицензии:

DataBase name|Тип лицензии
-----|-----
MongoDB|SSPL
Redis|Open-source
Cassandra|Open-source
Elasticsearch|Open-source
Firebase|Open-source

Тип:

DataBase name|Тип
-----|-----
MongoDB|Документоориентированная
Redis|Ключ-значение
Cassandra|"с широкими столбцами"
Elasticsearch|Документоориентированная
Firebase|Реального времени

Отдельно по каждой СУБД:
1. MongoDB

MongoDB является популярной NoSQL базой данных, которая известна своей масштабируемостью, производительностью и гибкостью. Вот некоторые из основных преимуществ использования MongoDB:

- Масштабируемость: MongoDB разработана таким образом, что ее можно легко расширять по горизонтали, что означает, что вы можете легко добавлять новые серверы к своей системе по мере роста данных. Это делает ее удобной для работы с очень большими объемами данных.
- Производительность: MongoDB известна своей высокой производительностью, особенно при работе с большими наборами данных. Она способна обрабатывать высокие уровни входящей и исходящей пропускной способности, что делает ее хорошим выбором для приложений, требующих реального ввременной обработки данных.
- Гибкость: Одним из ключевых преимуществ MongoDB является ее гибкая модель данных, которая позволяет хранить данные в различных форматах. Это делает ее удобной для хранения данных, которые не хорошо вписываются в структуру традиционной реляционной базы данных.
- Индексирование: MongoDB поддерживает широкий спектр вариантов индексирования, что делает ее удобной для эффективного поиска и извлечения данных.
- Легко использовать: MongoDB имеет простой и интуитивно понятный API, что делает ее удобной для разработчиков. Она также имеет большое и активное сообщество, что означает, что есть огромное количество ресурсов и поддержки.
- Распределенность: MongoDB поддерживает распределенные коллекции данных, что означает, что вы можете разбить данные на несколько серверов и работать с ними как с одним целым. Это позволяет более эффективно использовать мощности сервера и обеспечивает высокую доступность.
- Надежность: MongoDB поддерживает автоматическое реплицирование и разность уровней данных, что обеспечивает высокую надежность и защиту от потерь данных.
- Совместимость: MongoDB имеет драйверы для множества языков программирования, таких как Python, Java, C++, и т.д., что делает ее совместимой с большинством систем.
- Облачная поддержка: MongoDB предлагает облачные услуги, такие как MongoDB Atlas, которые позволяют легко и быстро развернуть и управлять базами данных в облаке. Это облегчает управление инфраструктурой и уменьшает затраты на сопровождение.
- Сообщество: MongoDB имеет активное и поддерживающее сообщество, что означает, что вы всегда сможете найти ответы на свои вопросы и получить помощь, когда это нужно.

Хотя MongoDB имеет множество преимуществ, также существуют некоторые ограничения и недостатки, которые следует учитывать при выборе этой базы данных:
- Нет транзакций: MongoDB не поддерживает транзакции, что означает, что вы не можете обеспечить атомарность операций с несколькими документами. Это может быть проблемой для некоторых приложений, требующих высокой степени целостности данных.
- Структура данных: В MongoDB все данные хранятся в документах, которые могут содержать различные поля. Это может быть удобно для некоторых случаев, но может быть сложно при работе с более структурированными данными, которые лучше подходят для таблиц реляционных баз данных.
- Отсутствие JOIN-операций: MongoDB не поддерживает JOIN-операции, что означает, что вы не можете соединять данные из разных коллекций или документов в одном запросе. Это может быть проблемой для некоторых приложений, которые требуют более сложных операций с данными.
- Ограниченное обслуживание запросов: MongoDB не поддерживает некоторые типы запросов, так как вложенные запросы и запросы на обновление части документа. Это может сложно обрабатываться на уровне приложения, что может увеличить сложность кода.
- Ограничения на размер документа: В MongoDB есть ограничение на размер отдельного документа, которое составляет 16 МБ. Это может быть проблемой для некоторых приложений, которые требуют хранения больших объемов данных в одном документе.
- Стоимость: MongoDB Atlas, сервис облачного хостинга MongoDB, может быть дороже, чем некоторые альтернативные решения, такие как Amazon RDS. Это может быть проблемой для некоторых компаний с ограниченным бюджетом.
- Отсутствие поддержки некоторых типов данных: MongoDB не поддерживает некоторые типы данных, такие как даты до 01 января 1970 года или время выше 23:59:59. Это может быть проблемой для некоторых приложений, которые требуют хранения таких данных.

2. Redis

Redis - это система управления базами данных, используемая для хранения и извлечения структурированных данных. Это быстрая нереляционная база данных для обработки данных в реальном времени. Она поддерживает различные данные включая строки, наборы, списки и карты. Кроме того, она поддерживает высокопроизводительные операционные системы, такие как Linux и macOS.

Основные преимущества:
- обладает сверхбыстрой скоростью работы и имеет исключительную производительность в процессе чтения и записи.
- удобен для разработчиков: эта система поддерживается большинством языков: C, C ++, C #, JavaScript, Java, Go, Objective-C, Python, PHP и другими.
- может использоваться вместе с другими базами данных как поддержка для снижения нагрузки и повышения производительности. Redis также используется в качестве первичной базы данных.
- поддерживает огромное разнообразие структур данных, позволяющее удовлетворить потребности разнообразных приложений.
- упрощает код, позволяя писать меньше строк для хранения, использования данных и организации доступа к данным в приложениях. Например, если приложение содержит данные, хранящиеся в хэш‑таблице, и требуется сохранить эти данные в хранилище, можно просто использовать структуру данных хэш‑таблицы Redis.

Основные недостатки:
- Ограниченный функционал: в Redis отсутствует тип данных для чисел с плавающей точкой, арифметические операции для строк, индексы для поиска записей, а также поддержка SQL запросов и процедурного языка.
- Отсутствие поддержки ACID: ACID – атомарность, целостность, изоляция и детерминированность. Транзакции, используемые для гарантирования ACID поведения в БД, не поддерживаются редисом.
- Ограниченный размер данных: Redis ограничен 32 МБ данных для каждого ключа. Если данные больше, то они должны быть разделены на несколько ключей.
- Отсутствие принуждающего кэша: Кэширование данных предотвращает повторные обращения к базе данных для извлечения данных, что ускоряет методы чтения. Но Redis не имеет принуждающего кэша.

3. Cassandra

Cassandra — это децентрализованная система, разработанная компанией Apache, бесплатная СУБД на базе Java, особенность которой заключается в ее функциях множественной репликации и множественного развертывания. Будучи быстро масштабируемой, Cassandra позволяет управлять большими объемами данных, реплицируя их на несколько узлов. Это устраняет проблему сбоя БД – если какой-либо из узлов в любой момент выходит из строя, он немедленно заменяется, и система продолжает работать до тех пор, пока хотя бы один узел находится в стабильном состоянии.
Cassandra использует свой собственный язык запросов CQL. По своему синтаксису он очень похож на SQL, но не применяет объединения, заменяя их так называемыми семействами столбцов. Второе отличие заключается в том, что не все столбцы в таблице хранятся для подзапросов. Некоторые из них используются в качестве столбцов кластеризации, где смежные данные помещаются рядом друг с другом для быстрого извлечения. Такой подход обеспечивает ускоренную выборку из объёмных наборов данных, ускоряя обработку данных таким образом.

Плюсы Cassandra
- Безопасность данных. Благодаря функции репликации Cassandra является весьма отказоустойчивой. Можно быть уверенным в безопасности данных до тех пор, пока все главные узлы не выйдут из строя одновременно. Иначе, СУБД и БД будут оставаться надежными и безопасными.
- Гибкость и внесение изменений. Простой синтаксис Cassandra впитал в себя лучшее из идеологий SQL и NoSQL. В дополнение к масштабируемости, это в значительной степени способствует гибкости набора данных. Cassandra собирает данные на ходу, и поиск данных отличается такой же простотой, несмотря на размер набора данных. Это позволяет максимально увеличивать БД.

Минусы Cassandra
- Медленное чтение. Поскольку Cassandra изначально была предназначена для скоростной записи, ее слабость заключается в неспособности к быстрому чтению.
- Потребность в дополнительных ресурсах. Поскольку Cassandra обрабатывает несколько слоев данных одновременно, для этого требуются серьёзные вычислительные ресурсы. На практике это приводит к дополнительным вложениям как в ПО, так и в аппаратное обеспечение.

СУБД Cassandra используется для хранения последовательных данных, логов, или огромного объема информации, который может генерироваться автоматически или путём измерений. 

4. Elasticsearch

Elasticsearch — это архитектура NoSQL, ориентированная на документы СУБД, в основе которой лежит полнотекстовая поисковая система. Построенный на базе библиотеки Apache Lucene, она хранит данные в виде файла JSON, поддерживает API RESTful и использует мощный аналитический механизм для более быстрого извлечения данных. Будучи программным обеспечением с открытым исходным кодом, она включает в себя как бесплатные, так и платные версии.

Плюсы Elasticsearch
- Масштабируемая архитектура. Одной из особенностей Elasticsearch является надежная распределенная архитектура. Ключевые параметры структуры, такие как кластеризация, индексирование, сегментирование и многие другие, обеспечивают широкое горизонтальное масштабирование, что позволяет размещать терабайты записей с дальнейшей автоматизацией. Уровни абстракции архитектуры упрощают управление системой как на индивидуальном, так и на совокупном уровнях.
- Быстрая обработка данных. Благодаря распределенной структуре данных и встроенному распараллеливанию база данных Elasticsearch показывает отличные результаты производительности. Даже при выполнении сложного запроса данных, она генерирует ответы на результаты поиска lightning. Это частично доступно благодаря тому, что документы хранятся рядом с соответствующими метаданными в индексе, что позволяет быстро находить их.

Минусы Elasticsearch
- Отсутствие мульти-языковой поддержки. Поддерживаются только форматы документа JSON.
- Ограниченные инструменты мониторинга. В случае возникновения внештатно ситуации, может оказаться что данная СБУД не имеет инструментов отчетности. Хотя проблемы обычно связаны с ограниченным объёмом памяти или емкостью диска, администраторы часто жалуются на ситуацию.

5. Firebase

База данных Firebase Realtime - это облачная NoSQL база данных компании Firebase . Данные хранятся в формате JSON и синхронизируются в режиме реального времени с каждым подключенным клиентом. 

Плюсы Firebase
- Низкий порог вхождения. Firebase может быть отличным вариантом для быстрого старта.
- Удобный доступ к данным, удобное управление. Через консоль обеспечивается легкого доступ к данным. Являясь одновременно облачными решением и обладая архитектурой NoSQL, СУБД обеспечивает достаточную гибкость и масштабируемость при увеличении объема данных. Кроме того, Firebase позволяет работать с адаптивными приложениями и обновлять данные даже при отсутствии подключения к Интернету.
- Проработанная документация. Документация включает в себя рекомендации, техническую документацию, ссылки на SDK, информацию об интеграции и многое другое. Сообщество развито, что позволяет легко находить ответы на возникающие проблемы.

Минусы Firebase
- Ограниченные возможности запроса. Проблема проявляется в ограниченности в выполнении простых запросов, так как для более сложных нет возможностей фильтрации. Это связано с тем, что вся БД представляет собой консолидированный файл формата JSON без каких-либо опций для моделирования данных.
- Ограниченная миграция данных. Перенос данных на другую платформу может потребовать серьёзных усилий. Отсутствуют инструменты миграции для передачи данных или установки БД проекта по умолчанию.

Вывод:
В программном продукте нет bigdata, необходимого для анализа, нет необходимости производить полнотекстовый поиск. Однако, важна производительность, работа в реальном времени.
Идеальным решением было бы использование MongoDB, но лицензия накладывает ограничение на использование облачных сервисов. Пусть цена и не высока, но что будет в будущем - не известно. В данном случае, актуально вбирать СУБД Firebase.

